<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <title>Web App – Material 0301</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div id="loginGate" class="login-gate">
    <div class="login-card">
      <div class="login-title">เข้าสู่ระบบ</div>
      <div class="login-subtitle">กรอก User และ Password เพื่อใช้งาน</div>
      <div class="login-form">
        <label class="login-label" for="loginUserInput">User</label>
        <input id="loginUserInput" class="login-input" type="text" placeholder="User" />
      </div>
      <div class="login-form">
        <label class="login-label" for="loginPassInput">Password</label>
        <input id="loginPassInput" class="login-input" type="password" placeholder="Password" />
      </div>
      <label class="login-remember">
        <input id="loginRemember" type="checkbox" />
        จดจำ User และ Password
      </label>
      <button id="loginBtn" class="login-btn" type="button">เข้าสู่ระบบ</button>
      <div class="status" id="loginStatus"></div>
    </div>
  </div>
  <div id="plantGate" class="plant-gate">
    <div class="plant-card">
      <div class="plant-title">เลือก Plant สำหรับสร้าง Barcode</div>
      <div class="plant-subtitle">เลือกฐานข้อมูลที่ต้องการก่อนเข้าใช้งาน</div>
      <div class="plant-form">
        <label class="plant-label" for="plantSelect">Plant</label>
        <select id="plantSelect" class="plant-select">
          <option value="" selected disabled>-- เลือก Plant --</option>
          <option value="0301">0301</option>
          <option value="0304">0304</option>
          <option value="0307">0307</option>
          <option value="0309">0309</option>
          <option value="0311">0311</option>
          <option value="0312">0312</option>
          <option value="0313">0313</option>
          <option value="0319">0319</option>
          <option value="0320">0320</option>
          <option value="0326">0326</option>
          <option value="0366">0366</option>
          <option value="0369">0369</option>
        </select>
      </div>
      <button id="plantEnterBtn" class="plant-enter-btn" type="button">เริ่มใช้งาน</button>
      <div class="plant-note">ระบบจะโหลดฐานข้อมูลตาม Plant ที่เลือก</div>
    </div>
  </div>
  <div class="app-shell">
    <header class="app-header">
      <div class="header-left">
        <button id="backToPlantBtn" class="back-plant-btn" type="button">&larr; เลือก Plant</button>
        <div class="title-block">
          <h1>Smart Warehouse Barcode</h1>
          <div class="subtitle">ระบบพิมพ์บาร์โค้ดฉลากสินค้า แบบ Small / Big</div>
        </div>
      </div>
      <div class="header-right">
        <button id="menuBtn" class="menu-btn" type="button">
          <span class="menu-title">เมนู</span>
          <span class="menu-caret">v</span>
        </button>
        <div id="menuPanel" class="menu-panel" aria-hidden="true">
          <div class="menu-panel-title">ข้อมูลผู้ใช้งาน</div>
          <div class="menu-grid">
            <div class="menu-row">
              <span class="menu-label">IDUser</span>
              <span class="menu-value" id="menuUserId">-</span>
            </div>
            <div class="menu-row">
              <span class="menu-label">Name</span>
              <span class="menu-value" id="menuUserName">-</span>
            </div>
            <div class="menu-row">
              <span class="menu-label">Nicname</span>
              <span class="menu-value" id="menuUserNickname">-</span>
            </div>
            <div class="menu-row">
              <span class="menu-label">Plant</span>
              <span class="menu-value" id="menuUserPlant">-</span>
            </div>
            <div class="menu-row">
              <span class="menu-label">PlantCode</span>
              <span class="menu-value" id="menuUserPlantCode">-</span>
            </div>
          </div>
          <button id="logoutBtn" class="menu-logout-btn" type="button">ออกจากระบบ</button>
        </div>
      </div>
    </header>

    <!-- Tabs -->
    <div class="tabs">
      <button class="tab-btn active" data-tab="barcode">
        <span class="icon">
          <svg viewBox="0 0 24 24" aria-hidden="true">
            <rect x="2" y="4" width="2" height="16"></rect>
            <rect x="6" y="4" width="1" height="16"></rect>
            <rect x="9" y="4" width="2" height="16"></rect>
            <rect x="13" y="4" width="1" height="16"></rect>
            <rect x="16" y="4" width="2" height="16"></rect>
            <rect x="20" y="4" width="1" height="16"></rect>
          </svg>
        </span>
        <span>Barcode</span>
      </button>
      <button class="tab-btn" data-tab="serial">
        <span class="icon">
          <svg viewBox="0 0 24 24" aria-hidden="true">
            <path d="M5 9h14v2H5zM5 13h14v2H5zM9 5h2l-1 14h-2l1-14zm6 0h2l-1 14h-2l1-14z"></path>
          </svg>
        </span>
        <span>Serial Number</span>
      </button>
      <button class="tab-btn" data-tab="grn">
        <span class="icon">
          <svg viewBox="0 0 24 24" aria-hidden="true">
            <path d="M7 4h10v2h3v14H4V6h3V4zm2 2v2h6V6H9zm-3 2v10h12V8H6z"></path>
          </svg>
        </span>
        <span>GRN</span>
      </button>
    </div>

    <!-- Tab: Barcode -->
    <div id="tab-barcode" class="tab-panel active">
      <div id="appRoot">
        <!-- Card: หัวตาราง + ปุ่ม Print + สถานะโหลดฐานข้อมูล -->
        <div class="card">
          <div class="card-header-row">
            <div class="card-title">
              <span>ตะกร้า Barcode</span>
              <span class="card-title-pill">Small & Big Label</span>
            </div>
            <div>
              <button id="printSmallBtn" class="print-btn">
                <span class="emoji">
                  <svg viewBox="0 0 24 24" aria-hidden="true">
                    <path d="M6 3h12v5H6zM6 14h12v7H6z"></path>
                    <rect x="4" y="9" width="16" height="4"></rect>
                  </svg>
                </span>
                Print Small
              </button>
              <button id="printBigBtn" class="print-btn">
                <span class="emoji">
                  <svg viewBox="0 0 24 24" aria-hidden="true">
                    <path d="M6 3h12v5H6zM6 14h12v7H6z"></path>
                    <rect x="4" y="9" width="16" height="4"></rect>
                  </svg>
                </span>
                Print Big
              </button>
            </div>
          </div>
          <div class="status" id="dataStatus"></div>
        </div>

        <!-- ข้อมูลพนักงาน -->
        <div class="card">
          <div class="card-title">
            ผู้คืน/คลังสินค้า
          </div>
          <div class="employee-row">
            <label>
              รหัสพนักงาน:
              <input id="empCodeInput" type="text" placeholder="กรอกรหัสพนักงาน แล้วกด Enter" />
            </label>
          </div>
          <div class="status" id="empStatus">กำลังโหลดข้อมูลพนักงาน...</div>
        </div>

        <!-- ตารางกรอกข้อมูล -->
        <div class="card">
          <div class="card-title">
            รายการ Material
          </div>
          <table id="entryTable">
            <thead>
              <tr>
                <th style="width:50px;">ลบ</th>
                <th style="width:60px;">ลำดับ</th>
                <th style="width:140px;">Material</th>
                <th>Description</th>
                <th style="width:140px;">Storage bin</th>
                <th style="width:120px;">คงเหลือ</th>
                <th style="width:100px;">จำนวน</th>
                <th style="width:120px;">Pack</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
          <div class="status" id="rowStatus"></div>
        </div>
      </div>

      <!-- Spinner -->
      <div class="spinner-container" id="spinner">
        <div class="spinner"></div>
      </div>

      <!-- พื้นที่สำหรับพิมพ์ฉลาก -->
      <div id="printArea"></div>
    </div>

    <!-- Tab: Serial Number -->
    <div id="tab-serial" class="tab-panel">
      <div class="card">
        <div class="card-header-row">
          <div class="card-title">
            จัดการ Serial Number
            <span class="card-title-pill">Invoice + Material + Serial</span>
          </div>
          <div class="serial-actions">
            <button id="saveSerialBtn" class="btn-serial-primary">
              <span class="btn-icon">
                <svg viewBox="0 0 24 24" aria-hidden="true">
                  <path d="M6 3h9l3 3v15H6z"></path>
                  <rect x="8" y="5" width="6" height="3"></rect>
                  <rect x="8" y="12" width="8" height="7"></rect>
                </svg>
              </span>
              บันทึก
            </button>
            <button id="printSerialBtn" class="btn-serial-outline">
              <span class="btn-icon">
                <svg viewBox="0 0 24 24" aria-hidden="true">
                  <path d="M6 3h12v5H6zM6 14h12v7H6z"></path>
                  <rect x="4" y="9" width="16" height="4"></rect>
                </svg>
              </span>
              Print Serial
            </button>
          </div>
        </div>

        <div class="serial-summary-row">
          <div class="serial-chip" id="serialSummaryInvoice">
            <span class="serial-chip-label">Invoice</span>
            <span class="serial-chip-value">-</span>
          </div>
          <div class="serial-chip" id="serialSummaryMaterial">
            <span class="serial-chip-label">Material</span>
            <span class="serial-chip-value">-</span>
          </div>
          <div class="serial-chip" id="serialSummaryCount">
            <span class="serial-chip-label">Serial</span>
            <span class="serial-chip-value">0 แถว</span>
          </div>
        </div>

        <div class="serial-form-row">
          <div class="serial-field serial-narrow">
            <span class="serial-label">Invoice</span>
            <input id="serialInvoiceInput" type="text"
                   class="serial-input"
                   placeholder="กรอก Invoice" />
          </div>

          <div class="serial-field serial-narrow">
            <span class="serial-label">Material</span>
            <input id="serialMatInput" type="text"
                   class="serial-input"
                   placeholder="กรอก/สแกน Material" />
          </div>

          <div class="serial-field serial-wide">
            <span class="serial-label">Description</span>
            <input id="serialDescInput" type="text"
                   class="serial-input"
                   readonly />
          </div>

          <div class="serial-field serial-narrow">
            <span class="serial-label">Storage bin</span>
            <input id="serialBinInput" type="text"
                   class="serial-input"
                   readonly />
          </div>
        </div>

        <div class="serial-form-row">
          <div class="serial-field serial-narrow">
            <span class="serial-label">Serial ตัวหน้า</span>
            <input id="serialPrefixInput" type="text"
                   class="serial-input"
                   placeholder="เช่น 0001" />
          </div>

          <div class="serial-field serial-narrow">
            <span class="serial-label">Serial ตัวหลัง</span>
            <input id="serialSuffixInput" type="text"
                   class="serial-input"
                   placeholder="เช่น A" />
          </div>
        </div>

        <div class="status" id="serialTopStatus">
          กรอก Invoice และ Material เพื่อดึง Description / Storage bin จากฐานข้อมูล
        </div>
      </div>

      <div class="card">
        <div class="card-title">
          ตาราง Serial Number
        </div>
        <table id="serialTable">
          <thead>
            <tr>
              <th style="width:60px;">ลบ</th>
              <th style="width:60px;">ลำดับ</th>
              <th style="width:140px;">Serial</th>
              <th style="width:140px;">Serial ตัวหน้า</th>
              <th style="width:140px;">Serial ตัวหลัง</th>
              <th style="width:160px;">SerialCP</th>
              <th style="width:120px;">Invoice</th>
              <th style="width:120px;">Material</th>
              <th>Description</th>
              <th style="width:140px;">Storage bin</th>
              <th style="width:160px;">Date</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
        <div class="status" id="serialStatus">
          แถวแรกถูกสร้างให้แล้ว กรอก Serial แล้วกด Enter เพื่อสร้างแถวถัดไป
        </div>
      </div>
    </div>

    <!-- Tab: GRN -->
    <div id="tab-grn" class="tab-panel">
      <div class="card">
        <div class="card-header-row">
          <div class="card-title">
            ข้อมูล GRN
            <span class="card-title-pill">Serial Data</span>
          </div>
        </div>
        <div class="grn-filters">
          <div class="grn-field">
            <span class="grn-label">Invoice</span>
            <select id="grnInvoiceFilter" class="grn-select"></select>
          </div>
          <div class="grn-field">
            <span class="grn-label">Date</span>
            <select id="grnDateFilter" class="grn-select"></select>
          </div>
          <div class="grn-field">
            <span class="grn-label">Material</span>
            <select id="grnMaterialFilter" class="grn-select"></select>
          </div>
          <div class="grn-actions">
            <button id="grnPrintBtn" class="btn-serial-outline" type="button">
              <span class="btn-icon">
                <svg viewBox="0 0 24 24" aria-hidden="true">
                  <path d="M6 3h12v5H6zM6 14h12v7H6z"></path>
                  <rect x="4" y="9" width="16" height="4"></rect>
                </svg>
              </span>
              Print Serial
            </button>
          </div>
        </div>
        <div class="status" id="grnStatus">กำลังโหลดข้อมูล GRN...</div>
      </div>

      <div class="card">
        <div class="card-title">ตาราง GRN</div>
        <table id="grnTable">
          <thead>
            <tr>
              <th style="width:60px;">
                <input id="grnSelectAll" class="grn-checkbox" type="checkbox" aria-label="เลือกทั้งหมด">
              </th>
              <th style="width:180px;">SerialCP</th>
              <th style="width:140px;">Invoice</th>
              <th style="width:140px;">Material</th>
              <th>Description</th>
              <th style="width:140px;">Storage bin</th>
              <th style="width:160px;">Date</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </div>

  <div id="confirmModal" class="modal" aria-hidden="true">
    <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="confirmModalTitle">
      <div id="confirmModalTitle" class="modal-title">ยืนยันการบันทึก</div>
      <div id="confirmModalMessage" class="modal-message">
        ต้องการบันทึกข้อมูลลง Google Sheet ใช่หรือไม่
      </div>
      <div class="modal-actions">
        <button id="confirmSaveBtn" class="btn-serial-primary" type="button">
          <span class="btn-icon">
            <svg viewBox="0 0 24 24" aria-hidden="true">
              <path d="M6 3h9l3 3v15H6z"></path>
              <rect x="8" y="5" width="6" height="3"></rect>
              <rect x="8" y="12" width="8" height="7"></rect>
            </svg>
          </span>
          ยืนยัน
        </button>
        <button id="cancelSaveBtn" class="btn-serial-outline" type="button">
          ยกเลิก
        </button>
      </div>
    </div>
  </div>

  <!-- QRCode & Barcode libs -->
  <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.1/build/qrcode.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script>

  <script src="barcode.js"></script>
</body>
</html>
